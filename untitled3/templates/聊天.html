<!DOCTYPE html>
<!-- saved from url=(0052)http://v.bootstrapmb.com/2018/9/ikobl2186/index.html -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="TTUNION_verify" content="b846c3c2b85efabc496d2a2b8399cd62">
    <meta name="sogou_site_verification" content="gI1bINaJcL">
    <meta name="360-site-verification" content="37ae9186443cc6e270d8a52943cd3c5a">
    <meta name="baidu_union_verify" content="99203948fbfbb64534dbe0f030cbe817">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE;chrome=1">
    <meta name="format-detection" content="telephone=no">
    <meta name="keywords" content="#">
    <meta name="description" content="#">
    <meta name="author" content="AUI, a-ui.com">
    <meta name="baidu-site-verification" content="ZVPGgtpUfW">
    <title>二手网站</title>
    <link rel="icon" type="image/x-icon" href="http://v.bootstrapmb.com/2018/9/ikobl2186/favicon.ico">
    <link href="http://v.bootstrapmb.com/2018/9/ikobl2186/iTunesArtwork@2x.png" sizes="114x114"
          rel="apple-touch-icon-precomposed">
    <link type="text/css" rel="stylesheet" href="/static/css/core.css">
    <link type="text/css" rel="stylesheet" href="/static/css/icon.css">
    <link type="text/css" rel="stylesheet" href="/static/css/home.css">
</head>
<body style=""><!-- head YDC begin -->
<audio controls="controls"  loop autoplay="autoplay" >

  <source  src="/static/mp3/清水淳一%20-%20Bloom%20of%20Youth.mp3" type="audio/mpeg" />
Your browser does not support the audio element.
</audio>
<header class="ydc-header">
    <div class="ydc-entered">
        <div class="ydc-header-content ydc-flex">

            <div class="ydc-column">
                <div class="ydc-column-user">
                    <div class="ydc-user-photo"><a href="javascript:;"><img
                            src="/static/{{ user.img }}" title="" about="" alt=""></a></div>
                    <div class="ydc-user-info">
                        <div class="ydc-user-info-name"><a href="../me">{{ user.name }}</a>
                            <div/>
                            <div class="ydc-user-info-nafme"><a href="../me">当前在线：{{ user.username }}</a></li>
                                <div class="ydc-user-info-func ydc-flex"><span class="ydc-tag">账号审核中</span><a
                                        href="/logout/">退出</a></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header><!-- head YDC end --><!-- content YDC begin -->
<section>
    <div class="ydc-content-slide ydc-body">
        <div class="ydc-flex"><!-- left begin -->
            <div class="ydc-column ydc-column-2">
                <div class="ydc-menu">
                    <ul>
                        <li class="ydc-menu-item"><a href="../son"
                                                     ><i class="ydc-icon ydc-icon-home fl"></i>首页</a>
                        </li>
                        <li class="ydc-menu-item"><a href="../see"
                                                     ><i class="ydc-icon ydc-icon-home fl"></i>查看</a>
                        </li>
                        <li class="ydc-menu-item"><a href="../to_chat"
                                                     class="active"><i class="ydc-icon ydc-icon-home fl"></i>信息</a>
                        </li>
                        <li class="ydc-menu-item"><a href="../fabu"><i
                                class="ydc-icon ydc-icon-find fl"></i>发布</a></li>
                        <li class="ydc-menu-item"><span class="ydc-menu-sub-title"><i
                                class="ydc-icon ydc-icon-file fl"></i>管理</span>
                            <ul>
                                <li><a href="../neirong">全部商品</a></li>

                            </ul>
                        </li>

                        </li>
                        <li class="ydc-menu-item"><span class="ydc-menu-sub-title"><i
                                class="ydc-icon ydc-icon-set fl"></i>设置</span>
                            <ul>
                                <li><a href="../me">账号信息</a></li>

                            </ul>
                        </li>
                        <li class="ydc-menu-item"><span class="ydc-menu-sub-title"><i
                                class="ydc-icon ydc-icon-customer fl"></i>客服</span>
                            <ul>
                                <li><a href="../zixun">在线咨询</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div><!-- left end --><!-- right begin -->
            <div class="ydc-column ydc-column-8">
                <div class="ydc-entered-box">
                    <div class="ydc-content-right">
                        <div class="ydc-right-head">
                           <div class="ydc-pane" style="display:block;">
                               <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
                               <style>
        td {
            border: 1px #000 solid;
            margin: 0;
        }

        textarea {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body style="padding: 30px">
<span id="userid">我的随机账号：</span>
<table>
    <tr>
        <td style="width: 500px;">
            <div id="historymsg" style="height: 400px;overflow: auto"></div>
        </td>
        <td style="width: 500px">
            <div id="userlist" style="height: 400px;overflow: auto"></div>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <textarea id="msg"></textarea>
        </td>
    </tr>
    <tr>
        <td colspan="2">
            <select class="form-control" id="isgroup">
            </select>
            <input class="btn btn-info btn-block" type="button" onclick="send()" value="发送">
        </td>
    </tr>
</table>

<script>
var ws,myid;
    window.onload = function () {
        //先判断浏览器是否支持websocket
        if ("WebSocket" in window) {
            // 打开一个 web socket,链接服务器
            ws = new WebSocket("ws:cchh.natapp1.cc/chat/");
            ws.onopen = function () {
                // Web Socket 已连接上，使用 send() 方法尝试发送数据
                ws.send("test");
            };
            //监听服务端是否有消息发送过来，当有消息时执行方法
            ws.onmessage = function (evt) {
                //获取服务器发来的消息
                var received_msg = evt.data;
                //判断是返回的是消息还是用户列表和id，1是消息，0是用户列表和id
                msg = eval("(" + received_msg + ")")
                //用户列表和id
                if (msg.type == 0) {
                    //userid为空表示更新用户列表,不需要更新自己的id，否则为初次登录
                    if (msg.userid != null) {
                        myid = msg.userid
                        $("#userid").append(myid)
                    }
                    //当收到新的用户列表时，清空原来的用户列表,清空原来的用户选择框,添加群组发送选项
                    $("#userlist").empty()
                    $("#isgroup").empty()
                    $("#isgroup").append("<option value='1'>群发（或选择要私聊的用户）</option>")
                    for (var i = 0; i < msg.userlist.length; i++) {
                        //填充用户列表
                        $("#userlist").append(msg.userlist[i] + "<hr />")
                        //填充用户选择框
                        $("#isgroup").append("<option value='" + msg.userlist[i] + "'>" + msg.userlist[i] + "</option>")
                    }
                }
                //用户发送的消息
                else {
                    var myDate = new Date();
                    nowtime = myDate.toLocaleString(); //获取日期与时间
                    newmsg = ""
                    //判断是自己的消息，绿色显示
                    if (myid == msg.data.user) {
                        newmsg = "<span style='color:blue'>" + msg.data.user + ":" + nowtime + "<br />" + msg.data.msg + "</span>" + "<br />"
                    } else {
                        newmsg = "<span >" + msg.data.user + ":" + nowtime + "<br />" + msg.data.msg + "</span>" + "<br />"
                    }
                    $("#historymsg").append(
                        newmsg
                    )
                }
            };
            //关闭页面或其他行为导致与服务器断开链接是执行
            ws.onclose = function () {
                // 关闭 websocket
                alert("连接已关闭...");
            };
        } else {
            // 浏览器不支持 WebSocket
            alert("您的浏览器不支持 WebSocket!");
        }
    }
	//消息发送
    function send() {
        msgtxt = $("#msg").val()
        msguser = $("#isgroup").val()
        //判断是否是群发0是，不是0 则是私聊
        if ($("#isgroup").val() == "1") {
            msg = {
                type: "1",
                txt: msgtxt,
                userfrom: myid
            }
        } else {
            msg = {
                type: "0",
                txt: msgtxt,
                userto: msguser,
                userfrom: myid
            }
        }
        //发送消息后清空消息框，并定位到消息框内
        $.post("/msg_send/", msg, function () {
            $("#msg").val("")
            $("#msg").focus()
        })
    }
</script>


                                </div>


                                        </div>




{% if all %}


                        <div class="ydc-group-table-item">
                                        <div class="ydc-group-table-item-img">
                                            <img src="/static/{{ all.img }}" title="" about="" alt=""></div>
                                        <div class="ydc-actions">
                                            <div>
                                                <button onclick="window.location.href='../see2?id={{ all.id }}'" class="ydc-actions-trigger">查看详细</button>
                                                <button onclick="window.location.href='../chat?id={{ all.id }}'" class="ydc-actions-trigger">发起聊天</button>
                                            </div>

                                        </div>

                                        <div class="ydc-group-table-item-text">
                                            <span><a href="#">{{ all.name }}</a></span>


                                        </div>
                                        <div class="ydc-group-table-item-info"><span>{{ time }}</span><span></span>
                                        </div>
                                    </div>
{% endif %}
                                    </div>
                                </div><!-- gongGao End --></div>
                        </div>
                    </div><!-- right end --></div>
            </div>

</section><!-- content YDC end -->
<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript">var slideIndex = 0;
showSlides();

function showSlides() {
    var i;
    var slides = document.getElementsByClassName("mySlides");
    for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
    }
    slideIndex++;
    if (slideIndex > slides.length) {
        slideIndex = 1
    }
    slides[slideIndex - 1].style.display = "block";
    setTimeout(showSlides, 3000);
}</script>
<script type="text/javascript">$(function () {
    $('.ydc-tabPanel ul li').click(function () {
        $(this).addClass('hit').siblings().removeClass('hit');
        $('.ydc-panes>div:eq(' + $(this).index() + ')').show().siblings().hide();
    })
})</script>
</body>
</html>